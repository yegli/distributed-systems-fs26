# Task 05 — AI Trip Summary

## Goal
One-click natural language summary of a trip's spending, generated by OpenAI.

## Deliverables
- `backend/src/routes/ai.js` — `GET /api/trips/:id/summary`
- `backend/src/prompts/tripSummary.js` — prompt template (easy to tweak)
- JWT protected, user must own the trip

## How It Works
1. Fetch trip + all expenses from DB
2. Aggregate: total spend, per-category breakdown, date range, currency mix
3. Build prompt from `tripSummary.js` template with the aggregated data
4. Call OpenAI `gpt-4o-mini` (cheap, fast, sufficient)
5. Return `{ summary: "..." }` to frontend

## Prompt Template (starting point)
```
You are a friendly travel finance assistant. Summarize the following trip expenses
in 3-4 sentences. Be specific about amounts, highlight the biggest spending category,
and add one lighthearted observation.

Trip: {name} to {destination}
Dates: {start_date} to {end_date}
Total spent: {total} (mixed currencies: {currencies})
Breakdown: {category_breakdown}
```

## Graceful Degradation
- If `OPENAI_API_KEY` is not set, return a mock summary so the app still works without a key
- If OpenAI call fails, return 502 with a user-friendly error message

## Acceptance Criteria
- Summary generated and returned in < 10 seconds
- Works with real trip data (Thailand seed data makes this look great in demo)
- Graceful fallback when API key absent
- Prompt file is clearly separated so it can be edited without touching route logic
